{{ if has .osid (list "linux-debian" "linux-ubuntu") -}}
#!/usr/bin/env bash
set -euo pipefail

readonly ELEVATE_PREFIX=$([ "$EUID" -ne 0 ] && echo "sudo")

$ELEVATE_PREFIX apt update
$ELEVATE_PREFIX apt install -y curl gnupg apt-transport-https sudo

$ELEVATE_PREFIX mkdir -p /etc/apt/keyrings

# for 1Password
curl -fsSL https://downloads.1password.com/linux/keys/1password.asc | \
  $ELEVATE_PREFIX gpg --dearmor --output /usr/share/keyrings/1password-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/1password-archive-keyring.gpg] https://downloads.1password.com/linux/debian/$(dpkg --print-architecture) stable main" | \
  $ELEVATE_PREFIX tee /etc/apt/sources.list.d/1password.list
$ELEVATE_PREFIX mkdir -p /etc/debsig/policies/AC2D62742012EA22/
curl -fsSL https://downloads.1password.com/linux/debian/debsig/1password.pol | \
  $ELEVATE_PREFIX tee /etc/debsig/policies/AC2D62742012EA22/1password.pol
$ELEVATE_PREFIX mkdir -p /usr/share/debsig/keyrings/AC2D62742012EA22
curl -fsSL https://downloads.1password.com/linux/keys/1password.asc | \
  $ELEVATE_PREFIX gpg --dearmor --output /usr/share/debsig/keyrings/AC2D62742012EA22/debsig.gpg

# for carapace-bin
echo "deb [trusted=yes] https://apt.fury.io/rsteube/ /" | \
  $ELEVATE_PREFIX tee /etc/apt/sources.list.d/fury-rsteube.list

# for eza
curl -fsSL https://raw.githubusercontent.com/eza-community/eza/main/deb.asc | \
  $ELEVATE_PREFIX gpg --dearmor -o /etc/apt/keyrings/gierens.gpg
echo "deb [signed-by=/etc/apt/keyrings/gierens.gpg] http://deb.gierens.de stable main" | \
  $ELEVATE_PREFIX tee /etc/apt/sources.list.d/gierens.list

# for node (from nodesource)
curl -fsSL https://deb.nodesource.com/setup_current.x | \
  $ELEVATE_PREFIX $([ "$EUID" -ne 0 ] && echo "-E") bash -

# for nushell
curl -fsSL https://apt.fury.io/nushell/gpg.key | \
  $ELEVATE_PREFIX gpg --dearmor --output /etc/apt/trusted.gpg.d/fury-nushell.gpg
echo "deb https://apt.fury.io/nushell/ /" | \
  $ELEVATE_PREFIX tee /etc/apt/sources.list.d/fury-nushell.list

# for q (dns client)
curl -fsSL https://repo.natesales.net/apt/gpg.key | \
  $ELEVATE_PREFIX gpg --dearmor --output /etc/apt/keyrings/natesales.gpg
echo "deb [signed-by=/etc/apt/keyrings/natesales.gpg] https://repo.natesales.net/apt * *" | \
  $ELEVATE_PREFIX tee /etc/apt/sources.list.d/natesales.list

# for vscode-insiders
curl -fsSL https://packages.microsoft.com/keys/microsoft.asc | \
  $ELEVATE_PREFIX gpg --dearmor --output /etc/apt/keyrings/packages.microsoft.gpg
echo "deb [arch=amd64,arm64,armhf signed-by=/etc/apt/keyrings/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main" | \
  $ELEVATE_PREFIX tee /etc/apt/sources.list.d/vscode.list
{{end -}}