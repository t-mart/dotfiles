{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Chezmoi Packages Schema",
  "description": "A list of software packages with conditional installation methods. An entry can either be for a language-specific package manager (uv, cargo) or for system-level ones (apt, winget, etc.), but not both.",
  "type": "array",
  "items": {
    "type": "object",
    "required": [
      "name"
    ],
    "properties": {
      "name": {
        "type": "string",
        "description": "The common, human-readable name of the software."
      },
      "description": {
        "type": "string",
        "description": "An optional note or description for the package."
      },
      "scoop": {
        "type": "string",
        "description": "The package identifier for Scoop, which must be in the 'bucket/package' format.",
        "pattern": "^[^/]+/[^/]+$"
      },
      "apt": {
        "type": "string",
        "description": "The package name for the Debian/Ubuntu Advanced Package Tool (apt)."
      },
      "irm-iex": {
        "type": "string",
        "description": "The URL for the PowerShell script to install the package using 'irm | iex'.",
        "format": "uri"
      },
      "winget": {
        "oneOf": [
          {
            "type": "string",
            "description": "The package identifier for winget."
          },
          {
            "type": "object",
            "description": "Configuration for the Windows Package Manager (winget).",
            "properties": {
              "id": {
                "type": "string",
                "description": "The package identifier for winget."
              },
              "elevate": {
                "type": "boolean",
                "description": "Whether to run the installer with administrator privileges.",
                "default": false
              },
              "interactive": {
                "type": "boolean",
                "description": "Whether to run the installer interactively.",
                "default": false
              }
            },
            "required": [
              "id"
            ],
            "additionalProperties": false
          }
        ]
      },
      "curl-sh": {
        "oneOf": [
          {
            "type": "string",
            "description": "The URL for the installation script.",
            "format": "uri"
          },
          {
            "type": "object",
            "description": "Configuration for a curl-to-sh installation script.",
            "properties": {
              "url": {
                "type": "string",
                "description": "The URL for the installation script.",
                "format": "uri"
              },
              "shell": {
                "type": "string",
                "description": "The shell to use for execution, e.g., 'sh', 'bash'."
              }
            },
            "required": [
              "url"
            ],
            "additionalProperties": false
          }
        ]
      },
      "cargo": {
        "type": "string",
        "description": "The crate name to be installed via 'cargo install'."
      },
      "uv": {
        "type": "string",
        "description": "The package name to be installed via 'uv pip install'."
      }
    },
    "allOf": [
      {
        "if": {
          "anyOf": [
            {
              "required": [
                "cargo"
              ]
            },
            {
              "required": [
                "uv"
              ]
            }
          ]
        },
        "then": {
          "properties": {
            "apt": false,
            "winget": false,
            "scoop": false,
            "curl-sh": false,
            "irm-iex": false
          },
          "description": "If 'cargo' or 'uv' is present, system-level package managers (apt, winget, scoop, curl-sh, irm-iex) are disallowed."
        }
      },
      {
        "not": {
          "required": [
            "cargo",
            "uv"
          ]
        },
        "description": "An entry cannot specify both 'cargo' and 'uv' simultaneously."
      }
    ],
    "anyOf": [
      {
        "required": [
          "winget"
        ]
      },
      {
        "required": [
          "scoop"
        ]
      },
      {
        "required": [
          "apt"
        ]
      },
      {
        "required": [
          "curl-sh"
        ]
      },
      {
        "required": [
          "cargo"
        ]
      },
      {
        "required": [
          "uv"
        ]
      },
      {
        "required": [
          "irm-iex"
        ]
      }
    ],
    "description": "Each entry must have at least one installation method defined.",
    "additionalProperties": false
  }
}
